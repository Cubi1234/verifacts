<div class="d-flex" id="wrapper">
  <!-- Sidebar -->
  <div id="sidebar-wrapper" [ngClass]="{ 'toggled': isSidebarOpen }">
    <ul class="sidebar-nav">
      <li class="sidebar-brand">
        <a href="#">
          <img src="assets/VerifactsLogoBlanco.png" alt="VeriFacts Logo" class="sidebar-logo">
        </a>
      </li>
      <li>
        <a href="#" (click)="selectTab('verified')">Verified Headlines</a>
      </li>
      <li>
        <a href="#" (click)="selectTab('related')">Related Searches</a>
      </li>
    </ul>
  </div>  

  <!-- Page Content -->
  <div id="page-content-wrapper">
    <app-header (toggleSidebar)="toggleSidebar()"></app-header>
    <div class="container mt-5">
      <div class="row justify-content-center">
        <div class="col-md-8 text-center">
          <h1 class="mb-4">Verify a news Headline</h1>
          <form (ngSubmit)="predictHeadline()" class="mb-3 rounded-lg p-4">
            <div class="input-group">
              <input type="text" [(ngModel)]="headline" name="headline" class="form-control" placeholder="Enter a news headline" required>
              <button type="submit" class="btn btn-primary">Verify</button>
            </div>
          </form>
          <ng-container *ngIf="prediction !== null">
            <div *ngIf="prediction" [@fadeIn] class="card mt-4">
              <div #headlineHistory class="card-body">
                <h1 class="card-title">Prediction</h1>
                <h2 class="card-text">{{ prediction }}</h2>
                <div class="mt-3">
                  <h6 class="text-start mb-0">Certainty</h6>
                  <div class="progress mt-1">
                    <div class="progress-bar" role="progressbar"
                         [style.width.%]="certainty ? certainty * 100 : 0"
                         [attr.aria-valuenow]="certainty ? certainty * 100 : 0"
                         aria-valuemin="0" aria-valuemax="100"
                         [ngClass]="{'progress-bar-clickbait': prediction === 'Clickbait', 'progress-bar-non-clickbait': prediction === 'Non-clickbait'}">
                      {{ certainty ? (certainty * 100).toFixed(2) : 0 }}%
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>      
        </div>
      </div>
      <div class="mb-3 col-12 text-center">
        <div class="tab-content" id="myTabContent">
          <div class="tab-pane fade" 
               [ngClass]="{ 'show active': selectedTab === 'verified' }" 
               id="verified" role="tabpanel" aria-labelledby="verified-tab">
            <div [@fadeIn]>
              <h2 class="mt-5">News headlines recently verified</h2>
              <i class="text-start mt-2">News headlines recently verified in VeriFacts.</i>
            </div>
            <div class="row mt-4">
              <div [@fadeIn] class="col-lg-4 col-md-6 col-sm-12 d-flex align-items-stretch" *ngFor="let entry of paginatedEntries">
                <div class="card mb-4 w-100">
                  <div class="card-body">
                    <h5 class="card-title">{{ entry[1] }}</h5>
                    <hr>
                    <h6 class="card-title">{{ entry[2] }}</h6>
                    <p class="card-text text-muted">{{ formatDate(entry[3]) }}</p>
                    <div class="progress mt-1">
                      <div class="progress-bar" role="progressbar"
                        [ngClass]="{'progress-bar-clickbait': entry[2] === 'Clickbait', 'progress-bar-non-clickbait': entry[2] === 'Non-clickbait'}"
                        [style.width.%]="entry[4] ? entry[4] * 100 : 0"
                        [attr.aria-valuenow]="entry[4] ? entry[4] * 100 : 0" aria-valuemin="0" aria-valuemax="100">
                        {{ entry[4] ? (entry[4] * 100).toFixed(2) : 0 }}%
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div *ngIf="showVerifiedHeadlines" class="mt-3" [@fadeIn]>
              <button class="me-5 mb-5 btn btn-primary" (click)="previousPage()" [disabled]="currentPage === 0">Previous</button>
              <button class="ms-5 mb-5 btn btn-primary" (click)="nextPage()" [disabled]="(currentPage + 1) * entriesPerPage >= entries.length">Next</button>
            </div>
          </div>
          
          <div class="tab-pane fade" [ngClass]="{ 'show active': selectedTab === 'related' }" 
              id="related" role="tabpanel" aria-labelledby="related-tab">
              <div *ngIf="factCheckResults.length > 0; else noResults" [@fadeIn]>
                <h2 class="mt-5">Related Searches</h2>
                <div class="row mt-4">
                  <div class="col-lg-4 col-md-6 col-sm-12 d-flex align-items-stretch" *ngFor="let result of getPaginatedResults()">
                    <div class="card-container">
                      <a [href]="result.claimReview[0].url" target="_blank" class="card-link">
                        <div class="card mb-4 w-100 card-hover custom-card">
                          <div class="card-body">
                            <h6 style="font-style: italic">{{ result.text }}</h6>
                            <hr>
                            <h6 class="card-subtitle mb-2 text-muted">{{ result.claimant }}</h6>
                            <p class="card-text"> {{ formatDate(result.claimDate) }}</p>
                            <div *ngIf="result.claimReview && result.claimReview.length > 0">
                              <p><strong>Review:</strong> {{ result.claimReview[0].textualRating }}</p>
                              <p><strong>Publisher:</strong> {{ result.claimReview[0].publisher.name }} ({{ result.claimReview[0].publisher.site }})</p>
                              <p><strong>Review Date:</strong> {{ formatDate(result.claimReview[0].reviewDate) }}</p>
                            </div>
                          </div>
                        </div>
                      </a>
                    </div>
                  </div>
                </div>
                <div class="mt-3" *ngIf="factCheckResults.length > itemsPerPageFacts" [@fadeIn]>
                  <button class="me-5 mb-5 btn btn-primary" (click)="previousPageFacts()" [disabled]="currentPageFacts === 0">Previous</button>
                  <button class="ms-5 mb-5 btn btn-primary" (click)="nextPageFacts()" [disabled]="currentPageFacts === getTotalFactPages() - 1">Next</button>
                </div>
              </div>
              <ng-template #noResults>
                <div class="text-center mt-5">
                  <h4>Verify a headline to view its related searches...</h4>
                </div>
              </ng-template>
            </div>
          </div>
        </div>
      </div>
      
